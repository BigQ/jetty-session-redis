<?xml version="1.0"?>
<!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure.dtd">
<Configure id="Server" class="org.eclipse.jetty.server.Server">

    <Call id="MBeanServer" class="java.lang.management.ManagementFactory" name="getPlatformMBeanServer"/>

    <New id="MBeanContainer" class="org.eclipse.jetty.jmx.MBeanContainer">
        <Arg>
            <Ref id="MBeanServer"/>
        </Arg>
    </New>

    <Get id="Container" name="container">
        <Call name="addEventListener">
            <Arg>
                <Ref id="MBeanContainer"/>
            </Arg>
        </Call>
    </Get>

    <Call name="addBean">
        <Arg>
            <Ref id="MBeanContainer"/>
        </Arg>
    </Call>

    <Get id="Logger" class="org.eclipse.jetty.util.log.Log" name="log"/>

    <Ref id="MBeanContainer">
        <Call name="addBean">
            <Arg>
                <Ref id="Logger"/>
            </Arg>
        </Call>
    </Ref>

    <Set name="stopAtShutdown">true</Set>
    <Set name="sendServerVersion">true</Set>
    <Set name="sendDateHeader">true</Set>
    <Set name="gracefulShutdown">1000</Set>

    <Set name="ThreadPool">
        <New class="org.eclipse.jetty.util.thread.QueuedThreadPool">
            <Set name="minThreads">10</Set>
            <Set name="maxThreads">200</Set>
        </New>
    </Set>

    <Call name="addConnector">
        <Arg>
            <New class="org.eclipse.jetty.server.nio.SelectChannelConnector">
                <Set name="host">
                    <Property name="jetty.host"/>
                </Set>
                <Set name="port">
                    <Property name="jetty.port" default="80"/>
                </Set>
            </New>
        </Arg>
    </Call>

    <Set name="handler">
        <New id="Handlers" class="org.eclipse.jetty.server.handler.HandlerCollection">
            <Set name="handlers">
                <Array type="org.eclipse.jetty.server.Handler">
                    <Item>
                        <New id="Contexts" class="org.eclipse.jetty.server.handler.ContextHandlerCollection"/>
                    </Item>
                    <Item>
                        <New id="DefaultHandler" class="org.eclipse.jetty.server.handler.DefaultHandler"/>
                    </Item>
                </Array>
            </Set>
        </New>
    </Set>

    <Set name="sessionIdManager">
        <New class="com.ovea.jetty.session.redis.RedisSessionIdManager">
            <Arg>
                <Ref id="Server"/>
            </Arg>
            <Set name="workerName">fred</Set>
            <Call name="setDriverInfo">
                <Arg>com.mysql.jdbc.Driver</Arg>
                <Arg>jdbc:mysql://127.0.0.1:3306/sessions?user=janb</Arg>
            </Call>
            <Set name="scavengeInterval">60</Set>
        </New>
    </Set>


    <!-- TODO: change for session clustering -->
    <!--<New class="org.eclipse.jetty.plus.jndi.Resource">
        <Arg>redis/jaxspot</Arg>
        <Arg>
            <New class="redis.clients.jedis.JedisPool">
                <Arg>
                    <New class="org.apache.commons.pool.impl.GenericObjectPool$Config">
                        <Set type="int" name="minIdle">4</Set>
                        <Set type="int" name="maxActive">10</Set>
                        <Set type="boolean" name="testOnBorrow">true</Set>
                    </New>
                </Arg>
                <Arg>127.0.0.1</Arg>
                <Arg type="int">6379</Arg>
            </New>
        </Arg>
    </New>-->

</Configure>
